"use strict";function IdNews(a,b,c){this.cnf=$.extend({title:"",limit:10,maxDesc:200,imgDim:[80,50],prefix:"id-",loadText:"Loading News...",template:'<div><span class="title"></span><span class="pag"></span></div><ul><li><div class="head"></div><div class="content"></div></li></ul>',fadeDelay:40,fadeDuration:300,toggleDuration:200},c||{}),this.$c=$(a).addClass(this.cnf.prefix+"news"),this.$c.append('<div class="'+this.cnf.prefix+'title">'+this.cnf.loadText+"</div>"),this.$c.width(this.cnf.width).height(this.cnf.height),this.load(b)}$(function(){new IdNews("#news","DqsF_ZG72xGLbes9l7okhQ")}),$.extend(IdNews.prototype,{load:function(a){$.ajax({url:"http://pipes.yahoo.com/pipes/pipe.run",crossDomain:!0,dataType:"jsonp",jsonp:"_callback",data:{_render:"json",_id:a},context:this,success:function(a,b,c){"success"===b?this.onLoad(a):console.log(b,c)}})},onLoad:function(a){this.$c.empty().append(this.cnf.template),this.$title=this.$c.find(".title").attr("class",this.cnf.prefix+"title"),this.$p=this.$c.find(".pag").attr("class",this.cnf.prefix+"pag"),this.$ul=this.$c.find("ul"),this.$li=this.$c.find("li").detach(),this.parse(a),this.$title.text(this.cnf.title||this.data.title),this.$title.click($.proxy(this.showPage,this)).click()},showPage:function(a){"number"!=typeof a&&(a=0),this.$ul.empty();var b,c,d,e=a*this.cnf.limit,f=e+this.cnf.limit;for(b=e;f>b&&(d=this.data.items[b],d);b++)c=this.$li.clone(),this.renderItem(c,d),this.$ul.append(c),c.css({opacity:0}).delay(this.cnf.fadeDelay*(b%this.cnf.limit)).animate({opacity:1},this.cnf.fadeDuration);this.setPagination(a+1)},setPagination:function(a){this.$p.empty();var b,c,d=this,e=pagination({page:a,links:5,rows:this.cnf.limit,total:this.data.items.length});for(b=0;b<e.length;b++)c=$('<span class="'+this.cnf.prefix+'pb">'),e[b].active||e[b].page?c.append(e[b].index):e[b].next?c.append(">"):e[b].last?c.append(">>"):e[b].prev?c.append("<"):e[b].first&&c.append("<<"),c.data("index",e[b].index-1),e[b].active?c.css("font-weight","bold"):c.click(function(){d.showPage($(this).data("index"))}),this.$p.append(c)},renderItem:function(a,b){var c,d=a.find(".head").attr("class",this.cnf.prefix+"head"),e=a.find(".content").attr("class",this.cnf.prefix+"content"),f=this;d.html(b.title).click(function(){c=!1,f.toggled?(f.toggled.toggle(f.cnf.toggleDuration),f.toggled=f.toggled===e?void 0:e.toggle(f.cnf.toggleDuration)):f.toggled=e.toggle(f.cnf.toggleDuration)}),e.append('<span class="'+this.cnf.prefix+'date">'+b.moment.fromNow()+"</span><br>",b.description),b.img&&e.prepend(this.getImg(b.img)),e.hide()},getImg:function(a){var b=$("<img>"),c=$('<div class="'+this.cnf.prefix+'img">'),d=this.cnf.imgDim[0],e=this.cnf.imgDim[1],f=a.w/a.h,g=1>=f?d/a.w:e/a.h;return b.attr({src:a.url,width:a.w*g||d,height:a.h*g||e,align:"left"}),c.width(d).height(e),c.append(b)},parse:function(a){this.data={title:a.value.title,items:[]};for(var b,c,d,e,f=a.value.items.length;f--;)b=a.value.items[f],c=moment(b.pubDate,"ddd, DD MMM YYYY HH:mm:ss ZZ"),c.isValid()||(c=moment(b.pubDate)),c.isValid()&&(d={moment:c,ms:+c,title:b.title,link:b.link,description:this.prepare(b.description,b.link)},e=b["media:thumbnail"]||b["media:content"],e&&(d.img={url:e.url,w:parseInt(e.width,10),h:parseInt(e.height,10)}),this.data.items.push(d));this.data.items.sort(function(a,b){return b.ms-a.ms})},prepare:function(a,b){if(a){a=a.replace(/(<([^>]+)>)/gi,"");var c=this.cnf.maxDesc<=a.length?" ":".";a=a.substring(0,a.lastIndexOf(c,this.cnf.maxDesc)),a.length&&(a+="...")}return a+='<a href="'+b+'" target="_blank">read more</a>'}});